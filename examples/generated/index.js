// Auto-generated by OCP Codegen
// Open Config Protocol - https://github.com/ocp-api-codegen-node
// Do not edit manually

const https = require('https');
const http = require('http');

const SCHEMA = {
  "$ocp": {
    "type": "rest",
    "version": "1.0.0"
  },
  "meta": {
    "name": "petstore-api",
    "base_url": "https://api.petstore.example.com/v1",
    "auth": {
      "type": "bearer"
    }
  },
  "pagination": {
    "type": "cursor",
    "param_name": "cursor",
    "response_path": "pagination.next_cursor",
    "default_limit": 20,
    "max_limit": 100
  },
  "endpoints": {
    "pets": {
      "list": {
        "method": "GET",
        "path": "/pets",
        "summary": "List all pets with optional filtering",
        "query": {
          "status": {
            "type": "string",
            "required": false,
            "description": "Filter by pet status",
            "enum": [
              "available",
              "pending",
              "sold"
            ]
          },
          "limit": {
            "type": "integer",
            "required": false,
            "description": "Maximum number of pets to return"
          },
          "cursor": {
            "type": "string",
            "required": false,
            "description": "Pagination cursor"
          }
        },
        "response": {
          "type": "Pet",
          "array": true
        },
        "pagination": true
      },
      "get": {
        "method": "GET",
        "path": "/pets/:petId",
        "summary": "Get a pet by ID",
        "params": {
          "petId": {
            "type": "string",
            "required": true,
            "description": "The pet's unique identifier"
          }
        },
        "response": {
          "type": "Pet"
        }
      },
      "create": {
        "method": "POST",
        "path": "/pets",
        "summary": "Create a new pet",
        "body": {
          "fields": {
            "name": {
              "type": "string",
              "required": true,
              "description": "The pet's name"
            },
            "species": {
              "type": "string",
              "required": true,
              "description": "Type of animal (dog, cat, bird, etc.)"
            },
            "breed": {
              "type": "string",
              "required": false,
              "description": "The pet's breed"
            },
            "age": {
              "type": "integer",
              "required": false,
              "description": "Age in years"
            },
            "status": {
              "type": "string",
              "required": false,
              "description": "Availability status"
            }
          }
        },
        "response": {
          "type": "Pet"
        }
      },
      "update": {
        "method": "PUT",
        "path": "/pets/:petId",
        "summary": "Update an existing pet",
        "params": {
          "petId": {
            "type": "string",
            "required": true
          }
        },
        "body": {
          "fields": {
            "name": {
              "type": "string",
              "required": false
            },
            "status": {
              "type": "string",
              "required": false
            }
          }
        },
        "response": {
          "type": "Pet"
        }
      },
      "delete": {
        "method": "DELETE",
        "path": "/pets/:petId",
        "summary": "Delete a pet",
        "params": {
          "petId": {
            "type": "string",
            "required": true
          }
        }
      }
    },
    "orders": {
      "list": {
        "method": "GET",
        "path": "/orders",
        "summary": "List all orders",
        "query": {
          "status": {
            "type": "string",
            "required": false,
            "enum": [
              "placed",
              "approved",
              "delivered"
            ]
          }
        },
        "response": {
          "type": "Order",
          "array": true
        },
        "pagination": true
      },
      "get": {
        "method": "GET",
        "path": "/orders/:orderId",
        "summary": "Get order by ID",
        "params": {
          "orderId": {
            "type": "string",
            "required": true
          }
        },
        "response": {
          "type": "Order"
        }
      },
      "create": {
        "method": "POST",
        "path": "/orders",
        "summary": "Place a new order",
        "body": {
          "fields": {
            "petId": {
              "type": "string",
              "required": true,
              "description": "ID of the pet to order"
            },
            "quantity": {
              "type": "integer",
              "required": true
            },
            "shipDate": {
              "type": "string",
              "required": false,
              "description": "ISO 8601 date string"
            }
          }
        },
        "response": {
          "type": "Order"
        }
      },
      "cancel": {
        "method": "DELETE",
        "path": "/orders/:orderId",
        "summary": "Cancel an order",
        "params": {
          "orderId": {
            "type": "string",
            "required": true
          }
        }
      }
    },
    "users": {
      "me": {
        "method": "GET",
        "path": "/users/me",
        "summary": "Get current authenticated user",
        "response": {
          "type": "User"
        }
      },
      "update_me": {
        "method": "PATCH",
        "path": "/users/me",
        "summary": "Update current user profile",
        "body": {
          "fields": {
            "name": {
              "type": "string",
              "required": false
            },
            "email": {
              "type": "string",
              "required": false
            },
            "phone": {
              "type": "string",
              "required": false
            }
          }
        },
        "response": {
          "type": "User"
        }
      }
    }
  }
};


function request(url, options, body) {
  return new Promise((resolve, reject) => {
    const parsedUrl = new URL(url);
    const client = parsedUrl.protocol === 'https:' ? https : http;

    const req = client.request(url, options, (res) => {
      let data = '';
      res.on('data', chunk => data += chunk);
      res.on('end', () => {
        try {
          const parsed = data ? JSON.parse(data) : null;
          if (res.statusCode >= 400) {
            const err = new Error(parsed?.message || `HTTP ${res.statusCode}`);
            err.status = res.statusCode;
            err.response = parsed;
            reject(err);
          } else {
            resolve(parsed);
          }
        } catch (e) {
          reject(new Error(`Failed to parse response: ${data}`));
        }
      });
    });

    req.on('error', reject);
    req.setTimeout(options.timeout || 30000, () => {
      req.destroy();
      reject(new Error('Request timeout'));
    });

    if (body) {
      req.write(JSON.stringify(body));
    }
    req.end();
  });
}


function buildPath(template, params) {
  let path = template;
  for (const [key, value] of Object.entries(params || {})) {
    path = path.replace(`:${key}`, encodeURIComponent(value));
  }
  return path;
}

function buildQueryString(params) {
  const query = new URLSearchParams();
  for (const [key, value] of Object.entries(params || {})) {
    if (value !== undefined && value !== null) {
      query.append(key, value);
    }
  }
  const str = query.toString();
  return str ? `?${str}` : '';
}


function createPetstoreApiClient(config) {
  let baseUrl = SCHEMA.meta.base_url;
  const urlParams = baseUrl.match(/\{(\w+)\}/g) || [];
  for (const param of urlParams) {
    const key = param.slice(1, -1);
    if (!config[key]) throw new Error(`Missing required config: ${key}`);
    baseUrl = baseUrl.replace(param, config[key]);
  }


  async function callEndpoint(endpoint, params = {}) {
    const token = config.token;


    const pathParams = {};
    const queryParams = {};
    const bodyParams = {};

    const pathParamNames = (endpoint.path.match(/:(\w+)/g) || []).map(p => p.slice(1));

    for (const [key, value] of Object.entries(params)) {
      if (pathParamNames.includes(key)) {
        pathParams[key] = value;
      } else if (endpoint.query && key in endpoint.query) {
        queryParams[key] = value;
      } else {
        bodyParams[key] = value;
      }
    }

    const path = buildPath(endpoint.path, pathParams);
    const queryString = buildQueryString(queryParams);
    const url = baseUrl + path + queryString;

    const hasBody = ['POST', 'PUT', 'PATCH'].includes(endpoint.method);
    const body = hasBody && Object.keys(bodyParams).length > 0 ? bodyParams : null;
    const finalBody = endpoint.body?.type === 'array' && Array.isArray(params) ? params : body;

    const headers = {
      'Content-Type': 'application/json'
    };

    headers['Authorization'] = `Bearer ${token}`;

    return request(url, {
      method: endpoint.method,
      headers,
      timeout: config.timeout || 30000
    }, finalBody);
  }

  return {
    pets: {
      list: (params) => callEndpoint({"method":"GET","path":"/pets","summary":"List all pets with optional filtering","query":{"status":{"type":"string","required":false,"description":"Filter by pet status","enum":["available","pending","sold"]},"limit":{"type":"integer","required":false,"description":"Maximum number of pets to return"},"cursor":{"type":"string","required":false,"description":"Pagination cursor"}},"response":{"type":"Pet","array":true},"pagination":true}, params),
      get: (params) => callEndpoint({"method":"GET","path":"/pets/:petId","summary":"Get a pet by ID","params":{"petId":{"type":"string","required":true,"description":"The pet's unique identifier"}},"response":{"type":"Pet"}}, params),
      create: (params) => callEndpoint({"method":"POST","path":"/pets","summary":"Create a new pet","body":{"fields":{"name":{"type":"string","required":true,"description":"The pet's name"},"species":{"type":"string","required":true,"description":"Type of animal (dog, cat, bird, etc.)"},"breed":{"type":"string","required":false,"description":"The pet's breed"},"age":{"type":"integer","required":false,"description":"Age in years"},"status":{"type":"string","required":false,"description":"Availability status"}}},"response":{"type":"Pet"}}, params),
      update: (params) => callEndpoint({"method":"PUT","path":"/pets/:petId","summary":"Update an existing pet","params":{"petId":{"type":"string","required":true}},"body":{"fields":{"name":{"type":"string","required":false},"status":{"type":"string","required":false}}},"response":{"type":"Pet"}}, params),
      delete: (params) => callEndpoint({"method":"DELETE","path":"/pets/:petId","summary":"Delete a pet","params":{"petId":{"type":"string","required":true}}}, params)
    },
    orders: {
      list: (params) => callEndpoint({"method":"GET","path":"/orders","summary":"List all orders","query":{"status":{"type":"string","required":false,"enum":["placed","approved","delivered"]}},"response":{"type":"Order","array":true},"pagination":true}, params),
      get: (params) => callEndpoint({"method":"GET","path":"/orders/:orderId","summary":"Get order by ID","params":{"orderId":{"type":"string","required":true}},"response":{"type":"Order"}}, params),
      create: (params) => callEndpoint({"method":"POST","path":"/orders","summary":"Place a new order","body":{"fields":{"petId":{"type":"string","required":true,"description":"ID of the pet to order"},"quantity":{"type":"integer","required":true},"shipDate":{"type":"string","required":false,"description":"ISO 8601 date string"}}},"response":{"type":"Order"}}, params),
      cancel: (params) => callEndpoint({"method":"DELETE","path":"/orders/:orderId","summary":"Cancel an order","params":{"orderId":{"type":"string","required":true}}}, params)
    },
    users: {
      me: (params) => callEndpoint({"method":"GET","path":"/users/me","summary":"Get current authenticated user","response":{"type":"User"}}, params),
      updateMe: (params) => callEndpoint({"method":"PATCH","path":"/users/me","summary":"Update current user profile","body":{"fields":{"name":{"type":"string","required":false},"email":{"type":"string","required":false},"phone":{"type":"string","required":false}}},"response":{"type":"User"}}, params)
    }
  };
}

module.exports = { createPetstoreApiClient };